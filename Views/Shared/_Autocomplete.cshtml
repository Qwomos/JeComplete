<input type="hidden" id="hidIdPerson" />
<input type="text" id="ddlSearch" class="form-control" />
<div class="list-group" id="lstResults">

<script>
    /* Parameters
        * Id : Identifier of the input control ( textbox )
        * Name : Name used in the form
        * Url : Url used for the search
        * Callback : Callback function when the user click on a list element
        * DataText : Template for the display of an list item
        * DataId : Identifier to write into the hidden input ( hiddenfield )
        * Class : Additionnal CSS class for the input control
    */

    $(document).ready(() => {
        $("#ddlSearch").keyup(ddlSearch_onKeyUp);
    });

    function ddlSearch_onKeyUp() {
        var lstResults = $("#lstResults");
        let term = $("#ddlSearch").val();

        lstResults.children().remove();

        if (term !== null && term.length > 1) {
            $.get(`people/SearchPeopleByNames/${encodeURIComponent(term)}`, (people) => {
                if (people !== null) {

                    for (let person of people) {
                        //displayForRedirect(person);
                        displayResults(person);
                    }
                }
            });
        }
    }

    function displayForRedirect(person) {
        let anchor = document.createElement("a");

        anchor.innerText = `${person.firstName} ${person.lastName}`;
        anchor.href = `People/PersonnelFile/${person.id}`;
        $(anchor).addClass("list-group-item");
        $(anchor).addClass("list-group-item-action");
        lstResults.append(anchor);
    }

    function displayResults(person) {
        let anchor = document.createElement("a");

        anchor.innerText = `${person.firstName} ${person.lastName}`;
        anchor.href = "#";
        $(anchor).attr("data-id", person.id);
        $(anchor).click(selectPerson);
        $(anchor).addClass("list-group-item");
        $(anchor).addClass("list-group-item-action");
        lstResults.append(anchor);
    }

    function selectPerson(e) {
        e.preventDefault();

        let personAnchor = $(this);
        let ddlSearch = $("#ddlSearch")

        $("#hidIdPerson").val(personAnchor.data("id"));
        $("#ddlSearch").val(personAnchor.text());
        $("#lstResults").empty();
    }
</script>